import{loginBtn,createVisitBtn,root}from"./constants.js";import LoginModal from"../classes/LoginModal.js";export function createAutorizationWindow(){const t=new LoginModal({id:"modalLogin",classes:["modal","login"]});t.createFormElements(),t.modal.style.width="45vw",root.append(t.modal),loginBtn.addEventListener("click",(function(){t.openModal();document.getElementById("submit").addEventListener("click",signIn)}))}let token,status;function signIn(t){t.preventDefault();const e=document.querySelector("#login"),o=document.querySelector("#password");autorization({email:e.value,password:o.value}).then(t=>{token=t;const n=document.getElementById("modalLogin"),a=document.getElementById("addinfo");let s=!0;200===status?(localStorage.setItem("token",token),n.remove(),loginBtn.style.display="none",createVisitBtn.style.display="block",createSearchForm(),createCardsForm(),createModalVisit(!0)):(a.textContent="Incorrect username or password",a.style.color="red",s=!1),s||(e.addEventListener("click",()=>{a.textContent="",s=!0}),o.addEventListener("click",()=>{a.textContent="",s=!0}))}).catch(t=>{console.log(t.message)})}function autorization(t){return fetch("https://ajax.test-danit.com/api/cards/login",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json;charset=utf-8"}}).then(t=>(status=t.status,console.log("autorization",t),t.text())).catch(t=>{console.log("Autorization request message: ",t.message)})}